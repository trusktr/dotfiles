var ot=Object.defineProperty;var it=(r,e,n)=>e in r?ot(r,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[e]=n;var b=(r,e,n)=>it(r,typeof e!="symbol"?e+"":e,n);import{A as J,ak as V,al as q,am as Ee,S as Fe,i as Ne,s as je,P as at,G as F,c as A,aa as be,K as W,e as z,R as lt,V as ct,W as ut,u as p,t as h,h as B,I as y,Q as E,L as M,f as O,a5 as Ce,q as T,r as P,M as L,a7 as We,af as ze,ag as H,a2 as mt,a3 as dt,a6 as ee,ab as te,n as R,ah as de,_ as gt,a9 as K}from"./SpinnerAugment-BEPEN2tu.js";import{e as ne,u as Ke,o as Qe}from"./BaseButton-DBHsDlhs.js";import{m as pt,g as ht,e as ft,t as $t,a as _t,o as St,M as It,n as xt,p as wt,A as yt,R as Ue,b as Mt,c as Lt,S as bt,d as Ct,G as zt,P as Bt,f as vt,h as qt,C as Rt,i as Dt,U as kt,j as Oe,E as Vt,k as Tt,l as Pt}from"./RemoteAgentRetry-Db_kk9DH.js";import"./Content-Bm7C6iJ1.js";import{g as ge,a as Xe,h as Ye,b as Ze,c as Je,d as et,e as tt,f as nt,j as st,k as pe,l as At,S as he,i as Be,E as Gt}from"./arrow-up-right-from-square-Yo0BPgM2.js";import"./folder-Cz5snpZv.js";import{aI as Ht,aq as Et,ar as Ft}from"./AugmentMessage-a30kNFnq.js";import{C as Nt,S as jt}from"./main-panel-CpWlwgqG.js";import"./isObjectLike-C4kUqRHQ.js";import{R as Wt}from"./check-56hMuF8e.js";import"./types-DDm27S8B.js";import"./MaterialIcon-BGa1zPPN.js";import"./keypress-DD1aQVr0.js";import"./autofix-state-d-ymFdyn.js";import"./index-CiMDylqQ.js";import"./Keybindings-tA5aIx1O.js";import"./CalloutAugment-DzngRWi1.js";import"./exclamation-triangle-Ovva0uhO.js";import"./CardAugment-RCmwRtRa.js";import"./TextTooltipAugment-DAVq7Vla.js";import"./IconButtonAugment-DT9AU8SC.js";import"./index-DY0Q9XhW.js";import"./pen-to-square-DEUxz3in.js";import"./augment-logo-DTgokSKV.js";import"./ButtonAugment-xh-SOBaV.js";import"./folder-opened-BLAu3pyz.js";import"./expand-QHrAftyc.js";import"./diff-utils-CHDUdEQq.js";import"./toggleHighContrast-CwIv4U26.js";import"./preload-helper-Dv6uf1Os.js";import"./index-oyQWDnzB.js";import"./trash-can-C3k9v09A.js";import"./CollapseButtonAugment-CEo2LYfW.js";import"./github-kew-evZ8.js";import"./index-DqflzTEb.js";import"./utils-Rh_q5w_c.js";import"./globals-D0QH3NT1.js";import"./types-DK4HA_lx.js";import"./file-paths-BcSg4gks.js";import"./types-CGlLNakm.js";import"./file-type-utils-B3gunxPI.js";import"./TextAreaAugment-C1Wf9cvH.js";import"./await_block-DO_bDmS_.js";import"./CopyButton-BVbGAvmE.js";import"./magnifying-glass-BmBw0jRN.js";import"./ellipsis-DsAFryUF.js";import"./IconFilePath-BCQiczSW.js";import"./LanguageIcon-CV8JBzL9.js";import"./next-edit-types-904A5ehg.js";import"./Filespan-CId0aUQb.js";import"./lodash-CujEqTm9.js";import"./mcp-logo-C2xFPiFq.js";import"./terminal-CS_V-nAg.js";import"./design-system-init-BG5cEFim.js";import"./StatusIndicator-By29C4Fu.js";import"./ra-diff-ops-model-pDvb0wIq.js";import"./VSCodeCodicon-DfXdb5mS.js";import"./chat-flags-model-CRX90O9_.js";class Kt{constructor(e=10){b(this,"samples",[]);b(this,"maxSamples");this.maxSamples=e}addSample(e,n=performance.now()){this.samples.push({position:e,timestamp:n}),this.samples.length>this.maxSamples&&this.samples.shift()}getVelocity(){if(this.samples.length<2)return 0;const e=this.samples.at(-1),n=this.samples.at(0),t=e.position-n.position,s=e.timestamp-n.timestamp;return s>0?t/s:0}getVelocityPPS(){return 1e3*this.getVelocity()}isFastScroll(e=500){return Math.abs(this.getVelocityPPS())>e}getDirection(){const e=this.getVelocity();return e>.05?"down":e<-.05?"up":"static"}predictPositionAfter(e){if(this.samples.length===0)return 0;const n=this.getVelocity();return this.samples[this.samples.length-1].position+n*e}reset(){this.samples=[]}getCurrentPosition(){return this.samples.length===0?0:this.samples[this.samples.length-1].position}}class Qt{captureScrollPosition(e){const{scrollHeight:n,scrollTop:t,clientHeight:s}=e;return{scrollHeight:n,scrollTop:t,clientHeight:s,distanceFromBottom:pt(e),timestamp:performance.now()}}restoreScrollPosition(e,n){const t=e.scrollHeight-n.distanceFromBottom-e.clientHeight;e.scrollTop=Math.max(0,t)}}class Ut{constructor(e,n={initialVisibleCount:20,batchSize:10}){b(this,"_config");b(this,"_disposables",[]);b(this,"_currentBatchSize");b(this,"_startIndex");b(this,"_endIndex");b(this,"_isLoading");b(this,"_loadingDirection");b(this,"_allItems");b(this,"_groupedAllItems");b(this,"_groupedVisibleItems");b(this,"hasMoreBefore");b(this,"hasMoreAfter");b(this,"isLoading");b(this,"loadingDirection");b(this,"totalItemCount");this._conversationModel=e,this._config={...n,minBatchSize:n.minBatchSize??n.batchSize,maxBatchSize:n.maxBatchSize??3*n.batchSize},this._currentBatchSize=this._config.batchSize,this._startIndex=J(0),this._endIndex=J(void 0),this._isLoading=J(!1),this._loadingDirection=J(null),this._allItems=V(this._conversationModel,s=>s.chatHistory.filter(o=>ge(o)||Xe(o)||Ye(o)||Ze(o)||Je(o)||et(o)||tt(o)||nt(o)||st(o)||pe(o))),this._groupedAllItems=V(this._allItems,s=>{const o=s.map((a,c)=>({turn:a,idx:c}));return this._groupItems(o)}),this._groupedVisibleItems=V([this._groupedAllItems,this._startIndex,this._endIndex],([s,o,a])=>{if(s.length===0)return[];let c=0;for(let l=0;l<s.length;l++){const m=s[l];if(m.turns[m.turns.length-1].idx>=o){c=l;break}if(l===s.length-1&&m.turns[m.turns.length-1].idx>=o){c=l;break}}let i=s.length-1;if(a!==void 0)for(let l=s.length-1;l>=0;l--){const m=s[l];if(m.turns[0].idx<=a){i=l;break}if(l===0&&m.turns[0].idx<=a){i=l;break}}return s.slice(c,i+1).map((l,m,f)=>({...l,isLastGroup:m===f.length-1}))}),this.hasMoreBefore=V([this._startIndex],([s])=>s>0),this.hasMoreAfter=V([this._endIndex,this._allItems],([s,o])=>s!==void 0&&s<o.length-1),this.isLoading=V(this._isLoading,s=>s),this.loadingDirection=V(this._loadingDirection,s=>s),this.totalItemCount=V(this._allItems,s=>s.length);const t=q(this._conversationModel);typeof t.onNewConversation=="function"&&this._disposables.push(t.onNewConversation(()=>{this.resetToBottom()})),this.resetToBottom()}subscribe(e){return this._groupedVisibleItems.subscribe(e)}loadMoreBefore(e){const n=q(this._startIndex),t=q(this._isLoading);if(n<=0||t)return!1;this._isLoading.set(!0),this._loadingDirection.set("before");const s=this._getValidBatchSize(e),o=Math.max(0,n-s);return this._startIndex.set(o),this._isLoading.set(!1),this._loadingDirection.set(null),!0}async loadToStart(e={}){const n=q(this._startIndex),t=q(this._isLoading);if(n<=0||t)return!1;this._isLoading.set(!0),this._loadingDirection.set("before");const{smooth:s,smoothInterval:o=500}=e;if(s)for(;this.loadMoreBefore();)await new Promise(a=>setTimeout(a,o)),await Ee();else this._startIndex.set(0);return this._isLoading.set(!1),this._loadingDirection.set(null),!0}loadMoreAfter(e){const n=q(this._endIndex),t=q(this._isLoading),s=q(this._allItems);if(n===void 0||n>=s.length-1||t)return!1;this._isLoading.set(!0),this._loadingDirection.set("after");const o=this._getValidBatchSize(e),a=Math.min(s.length-1,n+o);return a>=s.length-1?this._endIndex.set(void 0):this._endIndex.set(a),this._isLoading.set(!1),this._loadingDirection.set(null),!0}resetToBottom(){const e=q(this._allItems);if(e.length===0)return;const n=Math.max(0,e.length-this._config.initialVisibleCount);this._startIndex.set(n),this._endIndex.set(void 0)}resetToTop(){const e=q(this._allItems);if(e.length===0)return;const n=Math.min(e.length-1,this._config.initialVisibleCount-1);this._startIndex.set(0),this._endIndex.set(n)}async jumpToMessage(e){const n=q(this._allItems),t=n.findIndex(c=>c.request_id===e);if(t===-1)return!1;const s=Math.floor(this._config.initialVisibleCount/2),o=Math.max(0,t-s),a=t+s>=n.length-5?void 0:Math.min(n.length-1,t+s);return this._startIndex.set(o),this._endIndex.set(a),!0}_groupItems(e){return e.reduce((n,{turn:t,idx:s})=>((t.isToolResult===!0||ge(t)&&At(t))&&n.length>0||pe(t)&&n.length>0?n[n.length-1].turns.push({turn:t,idx:s}):n.push({turns:[{turn:t,idx:s}],firstRequestId:t.request_id,lastRequestId:t.request_id,isLastGroup:!1}),n),[]).map((n,t,s)=>{const o=n.turns.findLast(({turn:c})=>!!c.request_id),a=o==null?void 0:o.turn.request_id;return{...n,lastRequestId:a,isLastGroup:t===s.length-1}})}setDynamicBatchSize(e){this._currentBatchSize=this._getValidBatchSize(e)}getCurrentBatchSize(){return this._currentBatchSize}_getValidBatchSize(e){if(e===void 0)return this._currentBatchSize;const n=this._config.minBatchSize??this._config.batchSize,t=this._config.maxBatchSize??3*this._config.batchSize;return Math.max(n,Math.min(t,e))}dispose(){this._disposables.forEach(e=>e())}}function Ot(r){let e,n,t;const s=r[4].default,o=at(s,r,r[3],null);return{c(){e=F("div"),o&&o.c(),A(e,"class",n="c-gradient-mask "+r[2]+" svelte-say8yn"),be(e,"--fade-size",r[1]+"px"),W(e,"is-horizontal",r[0]==="horizontal")},m(a,c){z(a,e,c),o&&o.m(e,null),t=!0},p(a,[c]){o&&o.p&&(!t||8&c)&&lt(o,s,a,a[3],t?ut(s,a[3],c,null):ct(a[3]),null),(!t||4&c&&n!==(n="c-gradient-mask "+a[2]+" svelte-say8yn"))&&A(e,"class",n),(!t||2&c)&&be(e,"--fade-size",a[1]+"px"),(!t||5&c)&&W(e,"is-horizontal",a[0]==="horizontal")},i(a){t||(p(o,a),t=!0)},o(a){h(o,a),t=!1},d(a){a&&B(e),o&&o.d(a)}}}function Xt(r,e,n){let{$$slots:t={},$$scope:s}=e,{direction:o="vertical"}=e,{fadeSize:a=Ht}=e,{class:c=""}=e;return r.$$set=i=>{"direction"in i&&n(0,o=i.direction),"fadeSize"in i&&n(1,a=i.fadeSize),"class"in i&&n(2,c=i.class),"$$scope"in i&&n(3,s=i.$$scope)},[o,a,c,s,t]}class Yt extends Fe{constructor(e){super(),Ne(this,e,Xt,Ot,je,{direction:0,fadeSize:1,class:2})}}function ve(r,e,n){const t=r.slice();return t[52]=e[n],t[54]=n,t}function qe(r,e,n){const t=r.slice();t[55]=e[n].turn,t[56]=e[n].idx;const s=t[56]+1===t[14].length;return t[57]=s,t}function Re(r){let e,n;return e=new yt({}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function De(r){let e;return{c(){e=F("div"),e.textContent="Loading earlier messages...",A(e,"class","c-msg-list__loading svelte-80qwt2")},m(n,t){z(n,e,t)},d(n){n&&B(e)}}}function Zt(r){let e,n,t,s;const o=[ln,an],a=[];function c(i,l){return i[20].enableRichCheckpointInfo?0:1}return e=c(r),n=a[e]=o[e](r),{c(){n.c(),t=K()},m(i,l){a[e].m(i,l),z(i,t,l),s=!0},p(i,l){let m=e;e=c(i),e===m?a[e].p(i,l):(T(),h(a[m],1,1,()=>{a[m]=null}),P(),n=a[e],n?n.p(i,l):(n=a[e]=o[e](i),n.c()),p(n,1),n.m(t.parentNode,t))},i(i){s||(p(n),s=!0)},o(i){h(n),s=!1},d(i){i&&B(t),a[e].d(i)}}}function Jt(r){let e,n;return e=new Rt({props:{group:r[52].turns,chatModel:r[1],turn:r[55],turnIndex:r[56],isLastTurn:r[57],messageListContainer:r[0]}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};4194304&s[0]&&(o.group=t[52].turns),2&s[0]&&(o.chatModel=t[1]),4194304&s[0]&&(o.turn=t[55]),4194304&s[0]&&(o.turnIndex=t[56]),4210688&s[0]&&(o.isLastTurn=t[57]),1&s[0]&&(o.messageListContainer=t[0]),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function en(r){let e,n;return e=new Dt({props:{stage:r[55].stage,iterationId:r[55].iterationId,stageCount:r[55].stageCount}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};4194304&s[0]&&(o.stage=t[55].stage),4194304&s[0]&&(o.iterationId=t[55].iterationId),4194304&s[0]&&(o.stageCount=t[55].stageCount),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function tn(r){let e,n;return e=new kt({props:{chatModel:r[1],msg:r[55].response_text??""}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};2&s[0]&&(o.chatModel=t[1]),4194304&s[0]&&(o.msg=t[55].response_text??""),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function nn(r){let e,n;return e=new Et({props:{group:r[52].turns,markdown:r[55].response_text??"",messageListContainer:r[0]}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};4194304&s[0]&&(o.group=t[52].turns),4194304&s[0]&&(o.markdown=t[55].response_text??""),1&s[0]&&(o.messageListContainer=t[0]),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function sn(r){let e,n;function t(){return r[40](r[55])}return e=new Oe({props:{turn:r[55],preamble:jt,resendTurn:t,$$slots:{default:[cn]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment)},m(s,o){M(e,s,o),n=!0},p(s,o){r=s;const a={};4194304&o[0]&&(a.turn=r[55]),4194308&o[0]&&(a.resendTurn=t),4325376&o[0]|536870912&o[1]&&(a.$$scope={dirty:o,ctx:r}),e.$set(a)},i(s){n||(p(e.$$.fragment,s),n=!0)},o(s){h(e.$$.fragment,s),n=!1},d(s){L(e,s)}}}function rn(r){let e,n;return e=new Vt({props:{flagsModel:r[15],turn:r[55]}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};32768&s[0]&&(o.flagsModel=t[15]),4194304&s[0]&&(o.turn=t[55]),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function on(r){let e,n;return e=new Oe({props:{turn:r[55]}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};4194304&s[0]&&(o.turn=t[55]),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function an(r){let e,n;return e=new Tt({props:{turn:r[55]}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};4194304&s[0]&&(o.turn=t[55]),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function ln(r){let e,n;return e=new Pt({props:{turn:r[55]}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};4194304&s[0]&&(o.turn=t[55]),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function cn(r){let e,n;return e=new Ft({props:{conversationModel:r[17],turn:r[55]}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};131072&s[0]&&(o.conversationModel=t[17]),4194304&s[0]&&(o.turn=t[55]),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function ke(r){let e,n,t,s;function o(){return r[41](r[55])}return{c(){e=F("div"),A(e,"class","c-msg-list__turn-seen")},m(a,c){z(a,e,c),t||(s=ee(n=Lt.call(null,e,{onSeen:o,track:r[55].seen_state!==he.seen})),t=!0)},p(a,c){r=a,n&&te(n.update)&&4194304&c[0]&&n.update.call(null,{onSeen:o,track:r[55].seen_state!==he.seen})},d(a){a&&B(e),t=!1,s()}}}function Ve(r,e){let n,t,s,o,a,c,i,l,m,f,$,v,S,w,C=Be(e[55]);const k=[on,rn,sn,nn,tn,en,Jt,Zt],I=[];function x(u,_){return 4194304&_[0]&&(t=null),4194304&_[0]&&(s=null),4194304&_[0]&&(o=null),4194304&_[0]&&(a=null),4194304&_[0]&&(c=null),4194304&_[0]&&(i=null),4194304&_[0]&&(l=null),4194304&_[0]&&(m=null),t==null&&(t=!!Xe(u[55])),t?0:(s==null&&(s=!!Ze(u[55])),s?1:(o==null&&(o=!!Je(u[55])),o?2:(a==null&&(a=!!et(u[55])),a?3:(c==null&&(c=!!tt(u[55])),c?4:(i==null&&(i=!!nt(u[55])),i?5:(l==null&&(l=!!(ge(u[55])||Ye(u[55])||st(u[55]))),l?6:(m==null&&(m=!(!pe(u[55])||u[55].status!==Gt.success)),m?7:-1)))))))}~(f=x(e,[-1,-1]))&&($=I[f]=k[f](e));let d=C&&ke(e);return{key:r,first:null,c(){n=K(),$&&$.c(),v=E(),d&&d.c(),S=K(),this.first=n},m(u,_){z(u,n,_),~f&&I[f].m(u,_),z(u,v,_),d&&d.m(u,_),z(u,S,_),w=!0},p(u,_){let N=f;f=x(e=u,_),f===N?~f&&I[f].p(e,_):($&&(T(),h(I[N],1,1,()=>{I[N]=null}),P()),~f?($=I[f],$?$.p(e,_):($=I[f]=k[f](e),$.c()),p($,1),$.m(v.parentNode,v)):$=null),4194304&_[0]&&(C=Be(e[55])),C?d?d.p(e,_):(d=ke(e),d.c(),d.m(S.parentNode,S)):d&&(d.d(1),d=null)},i(u){w||(p($),w=!0)},o(u){h($),w=!1},d(u){u&&(B(n),B(v),B(S)),~f&&I[f].d(u),d&&d.d(u)}}}function Te(r){let e,n,t,s;const o=[$n,fn,hn,pn,gn,dn,mn,un],a=[];function c(i,l){return i[9]?0:i[6].retryMessage?1:i[6].showResumingRemoteAgent?2:i[6].showPaused?3:i[6].showGeneratingResponse?4:i[6].showAwaitingUserInput?5:i[6].showRunningSpacer?6:i[6].showStopped?7:-1}return~(e=c(r))&&(n=a[e]=o[e](r)),{c(){n&&n.c(),t=K()},m(i,l){~e&&a[e].m(i,l),z(i,t,l),s=!0},p(i,l){let m=e;e=c(i),e===m?~e&&a[e].p(i,l):(n&&(T(),h(a[m],1,1,()=>{a[m]=null}),P()),~e?(n=a[e],n?n.p(i,l):(n=a[e]=o[e](i),n.c()),p(n,1),n.m(t.parentNode,t)):n=null)},i(i){s||(p(n),s=!0)},o(i){h(n),s=!1},d(i){i&&B(t),~e&&a[e].d(i)}}}function un(r){let e,n;return e=new bt({}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p:R,i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function mn(r){let e;return{c(){e=F("div"),A(e,"class","c-agent-running-spacer svelte-80qwt2")},m(n,t){z(n,e,t)},p:R,i:R,o:R,d(n){n&&B(e)}}}function dn(r){let e,n;return e=new Ct({}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p:R,i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function gn(r){let e,n;return e=new zt({}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p:R,i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function pn(r){let e,n;return e=new Bt({}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p:R,i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function hn(r){let e,n;return e=new vt({}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p:R,i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function fn(r){let e,n;return e=new qt({props:{message:r[6].retryMessage}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};64&s[0]&&(o.message=t[6].retryMessage),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function $n(r){let e,n;return e=new Ue({props:{error:r[9].error,onRetry:r[9].onRetry,onDelete:r[9].onDelete}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};512&s[0]&&(o.error=t[9].error),512&s[0]&&(o.onRetry=t[9].onRetry),512&s[0]&&(o.onDelete=t[9].onDelete),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function _n(r){let e,n,t,s=[],o=new Map,a=ne(r[52].turns);const c=l=>l[55].request_id??`no-request-id-${l[56]}`;for(let l=0;l<a.length;l+=1){let m=qe(r,a,l),f=c(m);o.set(f,s[l]=Ve(f,m))}let i=r[52].isLastGroup&&Te(r);return{c(){for(let l=0;l<s.length;l+=1)s[l].c();e=E(),i&&i.c(),n=K()},m(l,m){for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(l,m);z(l,e,m),i&&i.m(l,m),z(l,n,m),t=!0},p(l,m){5423111&m[0]|4&m[1]&&(a=ne(l[52].turns),T(),s=Ke(s,m,c,1,l,a,o,e.parentNode,Qe,Ve,e,qe),P()),l[52].isLastGroup?i?(i.p(l,m),4194304&m[0]&&p(i,1)):(i=Te(l),i.c(),p(i,1),i.m(n.parentNode,n)):i&&(T(),h(i,1,1,()=>{i=null}),P())},i(l){if(!t){for(let m=0;m<a.length;m+=1)p(s[m]);p(i),t=!0}},o(l){for(let m=0;m<s.length;m+=1)h(s[m]);h(i),t=!1},d(l){l&&(B(e),B(n));for(let m=0;m<s.length;m+=1)s[m].d(l);i&&i.d(l)}}}function Sn(r){let e,n;return e=new Mt({props:{class:"c-msg-list__item--grouped",chatModel:r[1],isLastItem:r[52].isLastGroup,userControlsScroll:r[7],requestId:r[52].firstRequestId,releaseScroll:r[42],messageListContainer:r[0],minHeight:r[52].isLastGroup?r[13]:0,dataRequestId:r[52].firstRequestId,$$slots:{default:[_n]},$$scope:{ctx:r}}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};2&s[0]&&(o.chatModel=t[1]),4194304&s[0]&&(o.isLastItem=t[52].isLastGroup),128&s[0]&&(o.userControlsScroll=t[7]),4194304&s[0]&&(o.requestId=t[52].firstRequestId),128&s[0]&&(o.releaseScroll=t[42]),1&s[0]&&(o.messageListContainer=t[0]),4202496&s[0]&&(o.minHeight=t[52].isLastGroup?t[13]:0),4194304&s[0]&&(o.dataRequestId=t[52].firstRequestId),5423687&s[0]|536870912&s[1]&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function Pe(r,e){var o;let n,t,s;return t=new Nt.Item({props:{id:String((o=e[52].turns[0])==null?void 0:o.turn.timestamp),$$slots:{default:[Sn]},$$scope:{ctx:e}}}),{key:r,first:null,c(){n=K(),y(t.$$.fragment),this.first=n},m(a,c){z(a,n,c),M(t,a,c),s=!0},p(a,c){var l;e=a;const i={};4194304&c[0]&&(i.id=String((l=e[52].turns[0])==null?void 0:l.turn.timestamp)),5432007&c[0]|536870912&c[1]&&(i.$$scope={dirty:c,ctx:e}),t.$set(i)},i(a){s||(p(t.$$.fragment,a),s=!0)},o(a){h(t.$$.fragment,a),s=!1},d(a){a&&B(n),L(t,a)}}}function Ae(r){let e;return{c(){e=F("div"),e.textContent="Loading more messages...",A(e,"class","c-msg-list__loading svelte-80qwt2")},m(n,t){z(n,e,t)},d(n){n&&B(e)}}}function Ge(r){let e,n;return e=new Ue({props:{error:r[9].error,onRetry:r[9].onRetry,onDelete:r[9].onDelete}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};512&s[0]&&(o.error=t[9].error),512&s[0]&&(o.onRetry=t[9].onRetry),512&s[0]&&(o.onDelete=t[9].onDelete),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function In(r){let e,n,t,s,o,a,c,i,l,m,f,$=[],v=new Map,S=r[10]&&Re(),w=r[19]&&r[21]==="before"&&De(),C=ne(r[22]);const k=d=>d[52].firstRequestId??`no-request-id-${d[54]}`;for(let d=0;d<C.length;d+=1){let u=ve(r,C,d),_=k(u);v.set(_,$[d]=Pe(_,u))}let I=r[19]&&r[21]==="after"&&Ae(),x=!r[14].length&&r[9]&&Ge(r);return{c(){e=F("div"),S&&S.c(),n=E(),w&&w.c(),t=E();for(let d=0;d<$.length;d+=1)$[d].c();s=E(),I&&I.c(),o=E(),x&&x.c(),A(e,"class","c-msg-list svelte-80qwt2"),W(e,"c-msg-list--minimal",!r[20].fullFeatured)},m(d,u){z(d,e,u),S&&S.m(e,null),O(e,n),w&&w.m(e,null),O(e,t);for(let _=0;_<$.length;_+=1)$[_]&&$[_].m(e,null);O(e,s),I&&I.m(e,null),O(e,o),x&&x.m(e,null),r[43](e),l=!0,m||(f=[ee(a=$t.call(null,e,{onScrollIntoBottom:r[44],onScrollAwayFromBottom:r[45],onScroll:r[46]})),ee(c=_t.call(null,e,{onHeightChange:r[47]})),ee(i=St.call(null,e,{items:r[8]}))],m=!0)},p(d,u){d[10]?S?1024&u[0]&&p(S,1):(S=Re(),S.c(),p(S,1),S.m(e,n)):S&&(T(),h(S,1,1,()=>{S=null}),P()),d[19]&&d[21]==="before"?w||(w=De(),w.c(),w.m(e,t)):w&&(w.d(1),w=null),5432007&u[0]|4&u[1]&&(C=ne(d[22]),T(),$=Ke($,u,k,1,d,C,v,e,Qe,Pe,s,ve),P()),d[19]&&d[21]==="after"?I||(I=Ae(),I.c(),I.m(e,o)):I&&(I.d(1),I=null),!d[14].length&&d[9]?x?(x.p(d,u),16896&u[0]&&p(x,1)):(x=Ge(d),x.c(),p(x,1),x.m(e,null)):x&&(T(),h(x,1,1,()=>{x=null}),P()),a&&te(a.update)&&262305&u[0]&&a.update.call(null,{onScrollIntoBottom:d[44],onScrollAwayFromBottom:d[45],onScroll:d[46]}),c&&te(c.update)&&16&u[0]&&c.update.call(null,{onHeightChange:d[47]}),i&&te(i.update)&&256&u[0]&&i.update.call(null,{items:d[8]}),(!l||1048576&u[0])&&W(e,"c-msg-list--minimal",!d[20].fullFeatured)},i(d){if(!l){p(S);for(let u=0;u<C.length;u+=1)p($[u]);p(x),l=!0}},o(d){h(S);for(let u=0;u<$.length;u+=1)h($[u]);h(x),l=!1},d(d){d&&B(e),S&&S.d(),w&&w.d();for(let u=0;u<$.length;u+=1)$[u].d();I&&I.d(),x&&x.d(),r[43](null),m=!1,We(f)}}}function He(r){let e,n;return e=new It({props:{messageListElement:r[0],showScrollDown:r[12]}}),{c(){y(e.$$.fragment)},m(t,s){M(e,t,s),n=!0},p(t,s){const o={};1&s[0]&&(o.messageListElement=t[0]),4096&s[0]&&(o.showScrollDown=t[12]),e.$set(o)},i(t){n||(p(e.$$.fragment,t),n=!0)},o(t){h(e.$$.fragment,t),n=!1},d(t){L(e,t)}}}function xn(r){let e,n,t,s,o,a;n=new Yt({props:{$$slots:{default:[In]},$$scope:{ctx:r}}});let c=r[11]&&He(r);return{c(){e=F("div"),y(n.$$.fragment),t=E(),c&&c.c(),A(e,"class","c-msg-list-container svelte-80qwt2"),A(e,"data-testid","chat-message-list"),W(e,"c-msg-list--minimal",!r[20].fullFeatured)},m(i,l){z(i,e,l),M(n,e,null),O(e,t),c&&c.m(e,null),s=!0,o||(a=[Ce(e,"mouseenter",r[48]),Ce(e,"mouseleave",r[49])],o=!0)},p(i,l){const m={};8316919&l[0]|536870912&l[1]&&(m.$$scope={dirty:l,ctx:i}),n.$set(m),i[11]?c?(c.p(i,l),2048&l[0]&&p(c,1)):(c=He(i),c.c(),p(c,1),c.m(e,null)):c&&(T(),h(c,1,1,()=>{c=null}),P()),(!s||1048576&l[0])&&W(e,"c-msg-list--minimal",!i[20].fullFeatured)},i(i){s||(p(n.$$.fragment,i),p(c),s=!0)},o(i){h(n.$$.fragment,i),h(c),s=!1},d(i){i&&B(e),L(n),c&&c.d(),o=!1,We(a)}}}function wn(r,e,n){let t,s,o,a,c,i,l,m,f,$,v,S,w,C,k,I,x,d,u,_,N,fe,se=R,re=R,$e=()=>(re(),re=de(Q,g=>n(39,u=g)),Q),oe=R;r.$$.on_destroy.push(()=>se()),r.$$.on_destroy.push(()=>re()),r.$$.on_destroy.push(()=>oe());let{chatModel:Q}=e;$e();let{onboardingWorkspaceModel:ie}=e,{msgListElement:D}=e;const rt=ze("agentConversationModel"),{agentExchangeStatus:_e,isCurrConversationAgentic:Se}=rt;H(r,_e,g=>n(38,d=g)),H(r,Se,g=>n(37,x=g));const Ie=ze(Wt.key);H(r,Ie,g=>n(36,I=g));const G=new Ut(V(Q,g=>g.currentConversationModel),{initialVisibleCount:20,batchSize:10,minBatchSize:5,maxBatchSize:20});H(r,G,g=>n(22,fe=g));const{hasMoreBefore:xe,isLoading:we,loadingDirection:ye}=G;H(r,xe,g=>n(18,C=g)),H(r,we,g=>n(19,k=g)),H(r,ye,g=>n(21,N=g));const U=new Kt(3),Me=new Qt;mt(()=>{G.dispose()});let X=!1,Y=!1;function j(){n(7,X=!0)}async function ae(){if(!D||!C||k)return;j();const g=Me.captureScrollPosition(D),ce=U.getVelocityPPS(),ue=xt(ce,G.getCurrentBatchSize()),me=G.loadMoreBefore(ue);g&&(j(),Me.restoreScrollPosition(D,g),await Ee()),me&&D&&D.scrollTop<=1&&C&&ae()}dt(()=>{var g;((g=w.lastExchange)==null?void 0:g.seen_state)===he.unseen&&j()});let le=0,Z=!0;const Le=g=>w.markSeen(g);return r.$$set=g=>{"chatModel"in g&&$e(n(1,Q=g.chatModel)),"onboardingWorkspaceModel"in g&&n(2,ie=g.onboardingWorkspaceModel),"msgListElement"in g&&n(0,D=g.msgListElement)},r.$$.update=()=>{256&r.$$.dirty[1]&&(n(16,t=u.currentConversationModel),se(),se=de(t,g=>n(17,w=g))),256&r.$$.dirty[1]&&(n(15,s=u.flags),oe(),oe=de(s,g=>n(20,_=g))),480&r.$$.dirty[1]&&n(35,o=ht(u,d,x,I)),16&r.$$.dirty[1]&&n(14,a=o.chatHistory),16&r.$$.dirty[0]&&n(13,c=le),40&r.$$.dirty[0]&&n(12,i=!Z&&Y),16&r.$$.dirty[1]&&n(6,l=o.lastGroupConfig),16&r.$$.dirty[1]&&n(11,m=o.doShowFloatingButtons),16&r.$$.dirty[1]&&n(10,f=o.doShowAgentSetupLogs),64&r.$$.dirty[0]&&n(9,$=l.remoteAgentErrorConfig),16&r.$$.dirty[1]&&n(34,v=o.groupedChatHistory),8&r.$$.dirty[1]&&n(8,S=ft(v))},[D,Q,ie,Y,le,Z,l,X,S,$,f,m,i,c,a,s,t,w,C,k,_,N,fe,_e,Se,Ie,G,xe,we,ye,U,j,ae,Le,v,o,I,x,d,u,g=>ie.retryProjectSummary(g),g=>Le(g),()=>n(7,X=!0),function(g){gt[g?"unshift":"push"](()=>{D=g,n(0,D)})},()=>{n(7,X=!1),n(5,Z=!0),G.resetToBottom()},()=>{j(),n(5,Z=!1)},g=>{if(g<=1&&j(),D){U.addSample(g);const ce=U.getVelocityPPS(),ue=U.getDirection(),me=wt(ce,{baseThreshold:200,predictTime:300});ue==="up"&&g<me&&C&&ae()}},g=>n(4,le=g),()=>n(3,Y=!0),()=>n(3,Y=!1)]}class zs extends Fe{constructor(e){super(),Ne(this,e,wn,xn,je,{chatModel:1,onboardingWorkspaceModel:2,msgListElement:0},null,[-1,-1])}}export{zs as default};
