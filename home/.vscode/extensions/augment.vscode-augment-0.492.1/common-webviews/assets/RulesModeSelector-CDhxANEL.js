var Q=Object.defineProperty;var U=(a,t,e)=>t in a?Q(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var T=(a,t,e)=>U(a,typeof t!="symbol"?t+"":t,e);import{A as E,S as z,i as Y,s as H,a9 as G,e as m,q as A,t as p,r as F,u as $,h as f,n as k,ah as X,_ as B,$ as I,I as g,L as h,a1 as L,M as y,Q as q,X as v,G as Z,c as j,ae as J,Z as O}from"./SpinnerAugment-BEPEN2tu.js";import{W as K,e as N}from"./BaseButton-DBHsDlhs.js";import{R as w,a as V,A as tt}from"./types-DK4HA_lx.js";import{D as x}from"./index-DY0Q9XhW.js";import{B as P}from"./ButtonAugment-xh-SOBaV.js";import{C as et}from"./lodash-CujEqTm9.js";import{R as b,T as st}from"./TextTooltipAugment-DAVq7Vla.js";class bt{constructor(t){T(this,"_rulesFiles",E([]));T(this,"_loading",E(!0));this._msgBroker=t,this.requestRules()}handleMessageFromExtension(t){return!(!t.data||t.data.type!==K.getRulesListResponse)&&(this._rulesFiles.set(t.data.data),this._loading.set(!1),!0)}async requestRules(){this._loading.set(!0);try{const t=await this._msgBroker.sendToSidecar({type:w.getRulesListRequest});this._rulesFiles.set(t.data.rules)}catch(t){console.error("Failed to get rules list:",t)}finally{this._loading.set(!1)}}async createRule(t){try{const e=await this._msgBroker.sendToSidecar({type:w.createRule,data:{ruleName:t.trim()}});return await this.requestRules(),e.data.createdRule||null}catch(e){throw console.error("Failed to create rule:",e),e}}async getWorkspaceRoot(){try{return(await this._msgBroker.sendToSidecar({type:w.getWorkspaceRoot})).data.workspaceRoot||""}catch(t){return console.error("Failed to get workspace root:",t),""}}async updateRuleType(t){const e=V.formatRuleFileForMarkdown(t);try{await this._msgBroker.sendToSidecar({type:w.updateRuleFile,data:{path:t.path,content:e}})}catch(s){console.error("Failed to update rule file:",s)}await this.requestRules()}async deleteRule(t){try{await this._msgBroker.sendToSidecar({type:w.deleteRule,data:{path:t,confirmed:!0}}),await this.requestRules()}catch(e){throw console.error("Failed to delete rule:",e),e}}async processSelectedPaths(t){try{const e=await this._msgBroker.sendToSidecar({type:w.processSelectedPathsRequest,data:{selectedPaths:t,autoImport:!0}});return await this.requestRules(),{importedRulesCount:e.data.importedRulesCount,directoryOrFile:e.data.directoryOrFile,errors:e.data.errors}}catch(e){throw console.error("Failed to process selected paths:",e),e}}async getAutoImportOptions(){return await this._msgBroker.sendToSidecar({type:w.autoImportRules})}async processAutoImportSelection(t){try{const e=await this._msgBroker.sendToSidecar({type:w.autoImportRulesSelectionRequest,data:{selectedLabel:t.label}});return await this.requestRules(),{importedRulesCount:e.data.importedRulesCount,duplicatesCount:e.data.duplicatesCount,totalAttempted:e.data.totalAttempted,source:e.data.source}}catch(e){throw console.error("Failed to process auto-import selection:",e),e}}getRulesFiles(){return this._rulesFiles}getLoading(){return this._loading}}function M(a,t,e){const s=a.slice();return s[17]=t[e],s}function rt(a){let t,e,s,o;function r(n){a[12](n)}function u(n){a[13](n)}let i={$$slots:{default:[dt]},$$scope:{ctx:a}};return a[1]!==void 0&&(i.requestClose=a[1]),a[0]!==void 0&&(i.focusedIndex=a[0]),t=new x.Root({props:i}),B.push(()=>I(t,"requestClose",r)),B.push(()=>I(t,"focusedIndex",u)),{c(){g(t.$$.fragment)},m(n,l){h(t,n,l),o=!0},p(n,l){const c={};1048596&l&&(c.$$scope={dirty:l,ctx:n}),!e&&2&l&&(e=!0,c.requestClose=n[1],L(()=>e=!1)),!s&&1&l&&(s=!0,c.focusedIndex=n[0],L(()=>s=!1)),t.$set(c)},i(n){o||($(t.$$.fragment,n),o=!0)},o(n){p(t.$$.fragment,n),o=!1},d(n){y(t,n)}}}function ot(a){let t,e;return t=new st({props:{content:"Workspace guidelines are always applied",$$slots:{default:[pt]},$$scope:{ctx:a}}}),{c(){g(t.$$.fragment)},m(s,o){h(t,s,o),e=!0},p(s,o){const r={};1048576&o&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){e||($(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){y(t,s)}}}function at(a){let t,e=a[2].label+"";return{c(){t=v(e)},m(s,o){m(s,t,o)},p(s,o){4&o&&e!==(e=s[2].label+"")&&O(t,e)},d(s){s&&f(t)}}}function nt(a){let t,e;return t=new et({props:{slot:"iconRight"}}),{c(){g(t.$$.fragment)},m(s,o){h(t,s,o),e=!0},p:k,i(s){e||($(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){y(t,s)}}}function lt(a){let t,e,s;return e=new P({props:{color:"neutral",size:1,variant:"soft",$$slots:{iconRight:[nt],default:[at]},$$scope:{ctx:a}}}),{c(){t=Z("div"),g(e.$$.fragment),j(t,"class","c-dropdown-label svelte-9n7h82")},m(o,r){m(o,t,r),h(e,t,null),s=!0},p(o,r){const u={};1048580&r&&(u.$$scope={dirty:r,ctx:o}),e.$set(u)},i(o){s||($(e.$$.fragment,o),s=!0)},o(o){p(e.$$.fragment,o),s=!1},d(o){o&&f(t),y(e)}}}function it(a){let t,e=a[17].label+"";return{c(){t=v(e)},m(s,o){m(s,t,o)},p:k,d(s){s&&f(t)}}}function W(a){let t,e;return t=new x.Item({props:{onSelect:function(){return a[11](a[17])},highlight:a[2].label===a[17].label,$$slots:{default:[it]},$$scope:{ctx:a}}}),{c(){g(t.$$.fragment)},m(s,o){h(t,s,o),e=!0},p(s,o){a=s;const r={};4&o&&(r.highlight=a[2].label===a[17].label),1048576&o&&(r.$$scope={dirty:o,ctx:a}),t.$set(r)},i(s){e||($(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){y(t,s)}}}function D(a){let t,e,s,o;return t=new x.Separator({}),s=new x.Label({props:{$$slots:{default:[ct]},$$scope:{ctx:a}}}),{c(){g(t.$$.fragment),e=q(),g(s.$$.fragment)},m(r,u){h(t,r,u),m(r,e,u),h(s,r,u),o=!0},p(r,u){const i={};1048596&u&&(i.$$scope={dirty:u,ctx:r}),s.$set(i)},i(r){o||($(t.$$.fragment,r),$(s.$$.fragment,r),o=!0)},o(r){p(t.$$.fragment,r),p(s.$$.fragment,r),o=!1},d(r){r&&f(e),y(t,r),y(s,r)}}}function ct(a){let t,e=(a[4]!==void 0?a[5][a[4]].description:a[2].description)+"";return{c(){t=v(e)},m(s,o){m(s,t,o)},p(s,o){20&o&&e!==(e=(s[4]!==void 0?s[5][s[4]].description:s[2].description)+"")&&O(t,e)},d(s){s&&f(t)}}}function ut(a){let t,e,s,o=N(a[5]),r=[];for(let n=0;n<o.length;n+=1)r[n]=W(M(a,o,n));const u=n=>p(r[n],1,1,()=>{r[n]=null});let i=(a[4]!==void 0||a[2])&&D(a);return{c(){for(let n=0;n<r.length;n+=1)r[n].c();t=q(),i&&i.c(),e=G()},m(n,l){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(n,l);m(n,t,l),i&&i.m(n,l),m(n,e,l),s=!0},p(n,l){if(100&l){let c;for(o=N(n[5]),c=0;c<o.length;c+=1){const R=M(n,o,c);r[c]?(r[c].p(R,l),$(r[c],1)):(r[c]=W(R),r[c].c(),$(r[c],1),r[c].m(t.parentNode,t))}for(A(),c=o.length;c<r.length;c+=1)u(c);F()}n[4]!==void 0||n[2]?i?(i.p(n,l),20&l&&$(i,1)):(i=D(n),i.c(),$(i,1),i.m(e.parentNode,e)):i&&(A(),p(i,1,1,()=>{i=null}),F())},i(n){if(!s){for(let l=0;l<o.length;l+=1)$(r[l]);$(i),s=!0}},o(n){r=r.filter(Boolean);for(let l=0;l<r.length;l+=1)p(r[l]);p(i),s=!1},d(n){n&&(f(t),f(e)),J(r,n),i&&i.d(n)}}}function dt(a){let t,e,s,o;return t=new x.Trigger({props:{$$slots:{default:[lt]},$$scope:{ctx:a}}}),s=new x.Content({props:{side:"bottom",align:"start",$$slots:{default:[ut]},$$scope:{ctx:a}}}),{c(){g(t.$$.fragment),e=q(),g(s.$$.fragment)},m(r,u){h(t,r,u),m(r,e,u),h(s,r,u),o=!0},p(r,u){const i={};1048580&u&&(i.$$scope={dirty:u,ctx:r}),t.$set(i);const n={};1048596&u&&(n.$$scope={dirty:u,ctx:r}),s.$set(n)},i(r){o||($(t.$$.fragment,r),$(s.$$.fragment,r),o=!0)},o(r){p(t.$$.fragment,r),p(s.$$.fragment,r),o=!1},d(r){r&&f(e),y(t,r),y(s,r)}}}function $t(a){let t;return{c(){t=v("Always")},m(e,s){m(e,t,s)},d(e){e&&f(t)}}}function pt(a){let t,e;return t=new P({props:{color:"accent",size:1,disabled:!0,$$slots:{default:[$t]},$$scope:{ctx:a}}}),{c(){g(t.$$.fragment)},m(s,o){h(t,s,o),e=!0},p(s,o){const r={};1048576&o&&(r.$$scope={dirty:o,ctx:s}),t.$set(r)},i(s){e||($(t.$$.fragment,s),e=!0)},o(s){p(t.$$.fragment,s),e=!1},d(s){y(t,s)}}}function mt(a){let t,e,s,o,r;const u=[ot,rt],i=[];function n(l,c){return 8&c&&(t=null),t==null&&(t=!!l[7](l[3])),t?0:1}return e=n(a,-1),s=i[e]=u[e](a),{c(){s.c(),o=G()},m(l,c){i[e].m(l,c),m(l,o,c),r=!0},p(l,[c]){let R=e;e=n(l,c),e===R?i[e].p(l,c):(A(),p(i[R],1,1,()=>{i[R]=null}),F(),s=i[e],s?s.p(l,c):(s=i[e]=u[e](l),s.c()),$(s,1),s.m(o.parentNode,o))},i(l){r||($(s),r=!0)},o(l){p(s),r=!1},d(l){l&&f(o),i[e].d(l)}}}function ft(a,t,e){let s,o,r,u,i=k,n=()=>(i(),i=X(_,d=>e(4,u=d)),_);a.$$.on_destroy.push(()=>i());let{onSave:l}=t,{rule:c}=t;const R=[{label:"Always",value:b.ALWAYS_ATTACHED,description:"These Rules will be included in every message you send to the agent."},{label:"Manual",value:b.MANUAL,description:"These Rules will be included when manually tagged in your message. You can tag Rules by @-mentioning them."},{label:"Agent Requested",value:b.AGENT_REQUESTED,description:"These Rules will be included when the Agent decides to fetch them based on this file's description."}];let _;n();let S=()=>{};async function C(d){l(d.value,d.value!==b.AGENT_REQUESTED||c.description?c.description:"Example description"),S()}return a.$$set=d=>{"onSave"in d&&e(8,l=d.onSave),"rule"in d&&e(9,c=d.rule)},a.$$.update=()=>{512&a.$$.dirty&&e(3,s=c.path),512&a.$$.dirty&&e(10,o=c.type),1024&a.$$.dirty&&e(2,r=R.find(d=>d.value===o))},[_,S,r,s,u,R,C,function(d){return d===tt},l,c,o,d=>C(d),function(d){S=d,e(1,S)},function(d){_=d,n(e(0,_))}]}class vt extends z{constructor(t){super(),Y(this,t,ft,mt,H,{onSave:8,rule:9})}}export{bt as R,vt as a};
