exports.id=459,exports.ids=[459],exports.modules={698:(e,t,r)=>{r.d(t,{GutterChangesAnnotationProvider:()=>GutterChangesAnnotationProvider});var o=r(1398),n=r(9712),i=r(1538),a=r(6866),s=r(943),l=r(8492),u=r(3854),h=r(3244),c=r(5459),d=Object.defineProperty,p=Object.getOwnPropertyDescriptor,g=e=>{throw TypeError(e)};let m=0x40000000-1;let GutterChangesAnnotationProvider=class GutterChangesAnnotationProvider extends h.wJ{hoverProviderDisposable;sortedHunkStarts;state;constructor(e,t,r,o){super(e,t,"changes",r,o)}canReuse(e){return this.annotationContext?.sha===e?.sha&&this.annotationContext?.only===e?.only}clear(){return this.state=void 0,null!=this.hoverProviderDisposable&&(this.hoverProviderDisposable.dispose(),this.hoverProviderDisposable=void 0),super.clear()}nextChange(){if(null==this.sortedHunkStarts)return;let e=-1,t=this.editor.selection.active.line;for(let r of this.sortedHunkStarts)if(r>t){e=r;break}-1===e&&(e=this.sortedHunkStarts[0]),e>0&&(this.editor.selection=new o.Selection(e,0,e,0),this.editor.revealRange(new o.Range(e,0,e,0),o.TextEditorRevealType.InCenterIfOutsideViewport))}previousChange(){if(null==this.sortedHunkStarts)return;let e=-1,t=this.editor.selection.active.line;for(let r of this.sortedHunkStarts){if(r>=t)break;e=r}-1===e&&(e=this.sortedHunkStarts[this.sortedHunkStarts.length-1]),e>0&&(this.editor.selection=new o.Selection(e,0,e,0),this.editor.revealRange(new o.Range(e,0,e,0),o.TextEditorRevealType.InCenterIfOutsideViewport))}async onProvideAnnotation(e,t){var r,n,i,a,h,d=[];try{let r,n,i=(0,s.dQ)(),a=this.trackedDocument.uri.sha,h=e?.sha!=null&&e.sha!==a?`${e.sha}^`:void 0,p=this.container.git.getRepositoryService(this.trackedDocument.uri.repoPath),f=null==a&&null==h;if(f){let e=await p.commits.getOldestUnpushedShaForPath(this.trackedDocument.uri);if(null!=e)e=`${e}^`,r=await p.commits.getCommitForFile(this.trackedDocument.uri,e),null!=r?null!=h?h=e:(a=e,h=""):f=!1;else{let e=await p.status.getStatusForFile?.(this.trackedDocument.uri),t=e?.getPseudoCommits(this.container,await p.config.getCurrentUser());t?.length?(r=await p.commits.getCommitForFile(this.trackedDocument.uri),a="HEAD"):this.trackedDocument.dirty?a="HEAD":f=!1}}f||(r=await p.commits.getCommitForFile(this.trackedDocument.uri,h??a),null!=r&&(null!=h||(a=`${r.ref}^`),h=r.ref));let v=(await Promise.allSettled(null==h&&this.editor.document.isDirty?[this.container.git.getDiffForFileContents(this.trackedDocument.uri,a,this.editor.document.getText()),this.container.git.getDiffForFile(this.trackedDocument.uri,a,h)]:[this.container.git.getDiffForFile(this.trackedDocument.uri,a,h)])).map(e=>(0,l.Ro)(e)).filter(e=>!!e);if(!v?.length)return!1;let y=((e,t,r)=>{if(null!=t){var o,n;let i,a;"object"!=typeof t&&"function"!=typeof t&&g("Object expected"),void 0===o&&(o=t[i="dispose",(a=Symbol[i])?a:Symbol.for("Symbol."+i)]),"function"!=typeof o&&g("Object not disposable"),n&&(o=function(){try{n.call(this)}catch(e){return Promise.reject(e)}}),e.push([r,o,t])}else r&&e.push([r]);return t})(d,(0,u.u)(i)),b=new Map,w=e?.sha!=null&&e?.only?await this.container.git.getBlame(this.trackedDocument.uri,this.editor?.document):void 0;for(let t of(this.sortedHunkStarts=[],v))for(let r of t.hunks){if(null!=w){let t=!0,o=e.sha;for(let e=r.current.position.start-1;e<r.current.position.end;e++)w.lines[e]?.sha===o&&(t=!1);if(t)continue}for(let[e,t]of r.lines){if("unchanged"===t.state)continue;let r=this.editor.document.validateRange(new o.Range(new o.Position(e-1,0),new o.Position(e-1,m)));this.sortedHunkStarts.push(r.start.line),null==n&&(n=new o.Selection(r.start,r.end));let i=b.get(t.state);null==i?(i={decorationType:"added"===t.state?c.I.changesLineAddedAnnotation:"removed"===t.state?c.I.changesLineDeletedAnnotation:c.I.changesLineChangedAnnotation,rangesOrOptions:[{range:r}]},b.set(t.state,i)):i.rangesOrOptions.push({range:r})}}return this.sortedHunkStarts.sort((e,t)=>e-t),y?.restart({suffix:" to compute recent changes annotations"}),b.size&&(this.setDecorations([...b.values()]),y?.stop({suffix:" to apply all recent changes annotations"}),null==n||e?.selection===!1||t?.restoring||(this.editor.selection=n,this.editor.revealRange(n,o.TextEditorRevealType.InCenterIfOutsideViewport))),this.state={commit:r,diffs:v},this.registerHoverProvider(),!0}catch(e){var p=e,f=!0}finally{r=p,n=f,i="function"==typeof SuppressedError?SuppressedError:function(e,t,r,o){return(o=Error(r)).name="SuppressedError",o.error=e,o.suppressed=t,o},a=e=>r=n?new i(e,r,"An error was suppressed during disposal"):(n=!0,e),(h=e=>{for(;e=d.pop();)try{var t=e[1]&&e[1].call(e[2]);if(e[0])return Promise.resolve(t).then(h,e=>(a(e),h()))}catch(e){a(e)}if(n)throw r})()}}registerHoverProvider(){let e=i.H.get("hovers");e.enabled&&e.annotations.enabled&&(this.hoverProviderDisposable?.dispose(),this.hoverProviderDisposable=o.languages.registerHoverProvider({pattern:this.editor.document.uri.fsPath},{provideHover:(e,t,r)=>this.provideHover(e,t,r)}))}async provideHover(e,t,r){if(null==this.state||"line"!==i.H.get("hovers.annotations.over")&&0!==t.character)return;let{commit:a,diffs:s}=this.state;for(let r of s)for(let i of r.hunks){let r=i.previous.count>i.current.count;if(t.line>=i.current.position.start-1&&t.line<=i.current.position.end-!r){let s=await (0,n.ec)(a,this.trackedDocument.uri,t.line,i);if(null==s)return;return new o.Hover(s,e.validateRange(new o.Range(i.current.position.start-1,0,i.current.position.end-!r,m)))}}}};((e,t,r,o)=>{for(var n,i=p(t,r),a=e.length-1;a>=0;a--)(n=e[a])&&(i=(o?n(t,r,i):n(i))||i);return o&&i&&d(t,r,i)})([(0,a.Rm)()],GutterChangesAnnotationProvider.prototype,"onProvideAnnotation",1)},2360:(e,t,r)=>{r.d(t,{GutterHeatmapBlameAnnotationProvider:()=>GutterHeatmapBlameAnnotationProvider});var o=r(1398),n=r(6866),i=r(943),a=r(3854),s=r(9645),l=r(8825),u=Object.defineProperty,h=Object.getOwnPropertyDescriptor,c=e=>{throw TypeError(e)};let GutterHeatmapBlameAnnotationProvider=class GutterHeatmapBlameAnnotationProvider extends l.z{constructor(e,t,r,o){super(e,t,"heatmap",r,o)}async onProvideAnnotation(e,t){var r,n,l,u,h,d=[];try{let e,r=(0,i.dQ)(),n=await this.getBlame(t?.recompute);if(null==n)return!1;let l=((e,t,r)=>{if(null!=t){var o,n;let i,a;"object"!=typeof t&&"function"!=typeof t&&c("Object expected"),void 0===o&&(o=t[i="dispose",(a=Symbol[i])?a:Symbol.for("Symbol."+i)]),"function"!=typeof o&&c("Object not disposable"),n&&(o=function(){try{n.call(this)}catch(e){return Promise.reject(e)}}),e.push([r,o,t])}else r&&e.push([r]);return t})(d,(0,a.u)(r)),u=new Map,h=this.getComputedHeatmap(n);for(let t of n.lines){let r=t.line-1;e=n.commits.get(t.sha),null!=e&&(0,s.n0)(e.date,h,new o.Range(r,0,r,0),u)}return l?.restart({suffix:" to compute heatmap annotations"}),u.size&&(this.setDecorations([...u.values()]),l?.stop({suffix:" to apply all heatmap annotations"})),!0}catch(e){var p=e,g=!0}finally{r=p,n=g,l="function"==typeof SuppressedError?SuppressedError:function(e,t,r,o){return(o=Error(r)).name="SuppressedError",o.error=e,o.suppressed=t,o},u=e=>r=n?new l(e,r,"An error was suppressed during disposal"):(n=!0,e),(h=e=>{for(;e=d.pop();)try{var t=e[1]&&e[1].call(e[2]);if(e[0])return Promise.resolve(t).then(h,e=>(u(e),h()))}catch(e){u(e)}if(n)throw r})()}}};((e,t,r,o)=>{for(var n,i=h(t,r),a=e.length-1;a>=0;a--)(n=e[a])&&(i=(o?n(t,r,i):n(i))||i);return o&&i&&u(t,r,i)})([(0,n.Rm)()],GutterHeatmapBlameAnnotationProvider.prototype,"onProvideAnnotation",1)},8825:(e,t,r)=>{r.d(t,{z:()=>BlameAnnotationProviderBase});var o=r(1398),n=r(316),i=r(9712),a=r(1538),s=r(6866),l=r(3244),u=r(9645),h=Object.defineProperty,c=Object.getOwnPropertyDescriptor;let d=0x40000000-1;let BlameAnnotationProviderBase=class BlameAnnotationProviderBase extends l.wJ{blame;hoverProviderDisposable;constructor(e,t,r,o,n){super(e,t,r,o,n),this.blame=e.git.getBlame(this.trackedDocument.uri,o.document),o.document.isDirty&&n.setForceDirtyStateChangeOnNextDocumentChange()}clear(){return null!=this.hoverProviderDisposable&&(this.hoverProviderDisposable.dispose(),this.hoverProviderDisposable=void 0),super.clear()}async validate(){let e=await this.blame;return!!e?.lines.length}async getBlame(e){e&&(this.blame=this.container.git.getBlame(this.trackedDocument.uri,this.editor.document));let t=await this.blame;if(t?.lines.length)return t}getComputedHeatmap(e){let t,r,o,n=[];for(let o of e.lines)r!==o.sha&&(r=o.sha,null!=(t=e.commits.get(o.sha))&&n.push(t.date));n.sort((e,t)=>e.getTime()-t.getTime());let i=new Date;i.setDate(i.getDate()-(a.H.get("heatmap.ageThreshold")||90));let s=i.getTime(),l=[],h=[];for(let e of n)e.getTime()<s?h.push(e):l.push(e);o=l.length&&h.length?{hot:p(l),cold:p(h)}:p(n);let c=(e,t)=>Array.isArray(o)?o:t?o.hot.concat(o.cold):e.getTime()<s?o.cold:o.hot,d=(e,t)=>{let r=e.getTime(),o=0;for(let e=0;e<t.length&&(o=e,!(r>=t[e]));e++);return o};return{coldThresholdTimestamp:s,colors:(0,u.v7)(),computeRelativeAge:e=>d(e,c(e)),computeOpacity:e=>{let t=c(e,!0);return Math.max(.2,Math.round((1-d(e,t)/t.length)*100)/100)}}}registerHoverProviders(e){let t=a.H.get("hovers");t.enabled&&t.annotations.enabled&&(e.details||e.changes)&&(this.hoverProviderDisposable?.dispose(),this.hoverProviderDisposable=o.languages.registerHoverProvider({pattern:this.editor.document.uri.fsPath},{provideHover:(t,r,o)=>this.provideHover(e,t,r,o)}))}async provideHover(e,t,r,s){if("line"!==a.H.get("hovers.annotations.over")&&0!==r.character||this.editor.document.uri.toString()!==t.uri.toString())return;let l=await this.getBlame();if(null==l)return;let u=l.lines[r.line],h=l.commits.get(u.sha);if(null==h)return;let c=(await Promise.all([e.details?this.getDetailsHoverMessage(h,t):void 0,e.changes?(0,i.PV)(this.container,h,await n.nk.fromUri(t.uri),r.line,t):void 0])).filter(e=>!!e);return new o.Hover(c,t.validateRange(new o.Range(r.line,0,r.line,d)))}async getDetailsHoverMessage(e,t){let r=this.editor.selection.active.line,o=r+1;r=(e.lines.find(e=>e.line===o)??e.lines[0]).originalLine-1;let s=a.H.get("hovers");return(0,i.MX)(this.container,e,await n.nk.fromUri(t.uri),r,{autolinks:s.autolinks.enabled,dateFormat:a.H.get("defaultDateFormat"),format:s.detailsMarkdownFormat,pullRequests:s.pullRequests.enabled,timeout:250})}};function p(e){let t=[],r=Math.floor(e.length/2),o=e.length%2?e[r].getTime():(e[r-1].getTime()+e[r].getTime())/2,n=(e[e.length-1].getTime()-o)/5;for(let e=5;e>0;e--)t.push(o+n*e);t.push(o),n=(o-e[0].getTime())/4;for(let e=1;e<=4;e++)t.push(o-n*e);return t}((e,t,r,o)=>{for(var n,i=c(t,r),a=e.length-1;a>=0;a--)(n=e[a])&&(i=(o?n(t,r,i):n(i))||i);return o&&i&&h(t,r,i)})([(0,s.Rm)({args:!1})],BlameAnnotationProviderBase.prototype,"getComputedHeatmap",1)},9272:(e,t,r)=>{r.d(t,{GutterBlameAnnotationProvider:()=>GutterBlameAnnotationProvider});var o=r(1398),n=r(6378),i=r(5491),a=r(1538),s=r(6456),l=r(6866),u=r(5783),h=r(943),c=r(3854),d=r(4066),p=r(9645),g=r(8825),m=r(5459),f=Object.defineProperty,v=Object.getOwnPropertyDescriptor,y=e=>{throw TypeError(e)},b=(e,t,r,o)=>{for(var n,i=o>1?void 0:o?v(t,r):t,a=e.length-1;a>=0;a--)(n=e[a])&&(i=(o?n(t,r,i):n(i))||i);return o&&i&&f(t,r,i),i};let w=0x40000000-1;let GutterBlameAnnotationProvider=class GutterBlameAnnotationProvider extends g.z{constructor(e,t,r,o){super(e,t,"blame",r,o)}async clear(){if(await super.clear(),null!=m.I.gutterBlameHighlight)try{this.editor.setDecorations(m.I.gutterBlameHighlight,[])}catch{}}async onProvideAnnotation(e,t){var r,s,l,u,g,f=[];try{let e,r,s,l,u,g,v=(0,h.dQ)(),b=await this.getBlame(t?.recompute);if(null==b)return!1;let w=((e,t,r)=>{if(null!=t){var o,n;let i,a;"object"!=typeof t&&"function"!=typeof t&&y("Object expected"),void 0===o&&(o=t[i="dispose",(a=Symbol[i])?a:Symbol.for("Symbol."+i)]),"function"!=typeof o&&y("Object not disposable"),n&&(o=function(){try{n.call(this)}catch(e){return Promise.reject(e)}}),e.push([r,o,t])}else r&&e.push([r]);return t})(f,(0,c.u)(v)),P=a.H.get("blame"),D=(0,d.Vx)(P.format).reduce((e,t)=>(e[t.key]=t.options,e),Object.create(null));i.c.has(P.format,"tips")&&(e=await this.container.git.getRepositoryService(b.repoPath).getBranchesAndTagsTipsLookup());let H={dateFormat:null===P.dateFormat?a.H.get("defaultDateFormat"):P.dateFormat,getBranchAndTagTips:e,tokenOptions:D},x={family:a.H.get("blame.fontFamily"),size:a.H.get("blame.fontSize"),style:a.H.get("blame.fontStyle"),weight:a.H.get("blame.fontWeight")},S=P.avatars,k=a.H.get("defaultGravatarsStyle"),A=P.separateLines,O=(0,p.kM)(A,P.heatmap,P.avatars,P.format,H,x),R=[],B=new Map,T=S?new Map:void 0,C=!1;for(let e of(P.heatmap.enabled&&(u=this.getComputedHeatmap(b)),b.lines)){let t=e.line-1;if(l===e.sha){if(null==s)continue;s={...s},P.compact&&!C&&(null==g&&(g=n.EO.Space.repeat((0,d.RG)(s.renderOptions.before.contentText))),s.renderOptions={before:{...s.renderOptions.before,contentText:g}},A&&(s.renderOptions.before.textDecoration=`none;box-sizing: border-box${S?";padding: 0 0 0 18px":""}${x.family?`;font-family: ${x.family}`:""}${x.size?`;font-size: ${x.size}px`:""}`),C=!0),s.range=new o.Range(t,0,t,0),R.push(s);continue}if(C=!1,l=e.sha,r=b.commits.get(e.sha),null!=r){if(s=B.get(e.sha),null!=s){s={...s,range:new o.Range(t,0,t,0)},R.push(s);continue}s=(0,p.w)(r,P.format,H,O),null!=u&&(0,p.nx)(s,r.date,u),s.range=new o.Range(t,0,t,0),R.push(s),S&&null!=r.author.email&&await this.applyAvatarDecoration(r,s,k,T),B.set(e.sha,s)}}return w?.restart({suffix:" to compute gutter blame annotations"}),R.length&&(this.setDecorations([{decorationType:m.I.gutterBlameAnnotation,rangesOrOptions:R}]),w?.stop({suffix:" to apply all gutter blame annotations"})),this.registerHoverProviders(a.H.get("hovers.annotations")),!0}catch(e){var v=e,b=!0}finally{r=v,s=b,l="function"==typeof SuppressedError?SuppressedError:function(e,t,r,o){return(o=Error(r)).name="SuppressedError",o.error=e,o.suppressed=t,o},u=e=>r=s?new l(e,r,"An error was suppressed during disposal"):(s=!0,e),(g=e=>{for(;e=f.pop();)try{var t=e[1]&&e[1].call(e[2]);if(e[0])return Promise.resolve(t).then(g,e=>(u(e),g()))}catch(e){u(e)}if(s)throw r})()}}async selection(e){let t;if(!1===e||null==m.I.gutterBlameHighlight)return;let r=await this.blame;if(!r?.lines.length)return;if(e?.sha!=null)t=e.sha;else if(e?.line!=null){if(e.line>=0){let o=r.lines[e.line];t=o?.sha}}else t=(0,u.$1)(r.commits.values())?.sha;if(!t)return void this.editor.setDecorations(m.I.gutterBlameHighlight,[]);let n=(0,s.x1)(r.lines,e=>e.sha===t?this.editor.document.validateRange(new o.Range(e.line-1,0,e.line-1,w)):void 0);this.editor.setDecorations(m.I.gutterBlameHighlight,n)}async applyAvatarDecoration(e,t,r,o){let n=o.get(e.author.email??"");if(null==n){let t=(await e.getAvatarUri({defaultStyle:r,size:16})).toString(!0);n={contentText:"",height:"16px",width:"16px",textDecoration:`none;position:absolute;top:1px;left:5px;background:url(${encodeURI(t)});background-size:16px 16px;margin-left: 0 !important`},o.set(e.author.email??"",n)}t.renderOptions.after=n}};b([(0,l.Rm)()],GutterBlameAnnotationProvider.prototype,"onProvideAnnotation",1),b([(0,l.Rm)({args:!1})],GutterBlameAnnotationProvider.prototype,"selection",1)}};