exports.id=624,exports.ids=[624],exports.modules={641:(e,n,t)=>{t.d(n,{GitCodeLensProvider:()=>GitCodeLensProvider});var i=t(1398),s=t(1518),o=t(3949),r=t(4301),a=t(1078),l=t(6612),c=t(4465),u=t(7747),d=t(7005),m=t(5419),g=t(3934),h=(e,n)=>(n=Symbol[e])?n:Symbol.for("Symbol."+e),y=e=>{throw TypeError(e)},p=(e,n,t)=>{if(null!=n){var i,s;"object"!=typeof n&&"function"!=typeof n&&y("Object expected"),t&&(i=n[h("asyncDispose")]),void 0===i&&(i=n[h("dispose")],t&&(s=i)),"function"!=typeof i&&y("Object not disposable"),s&&(i=function(){try{s.call(this)}catch(e){return Promise.reject(e)}}),e.push([t,i,n])}else t&&e.push([t]);return n},b=(e,n,t)=>{var i="function"==typeof SuppressedError?SuppressedError:function(e,n,t,i){return(i=Error(t)).name="SuppressedError",i.error=e,i.suppressed=n,i},s=e=>n=t?new i(e,n,"An error was suppressed during disposal"):(t=!0,e),o=i=>{for(;i=e.pop();)try{var r=i[1]&&i[1].call(i[2]);if(i[0])return Promise.resolve(r).then(o,e=>(s(e),o()))}catch(e){s(e)}if(t)throw n};return o()};let GitRecentChangeCodeLens=class GitRecentChangeCodeLens extends i.CodeLens{constructor(e,n,t,i,s,o,r,a,l,c){super(a,c),this.languageId=e,this.symbol=n,this.uri=t,this.dateFormat=i,this.blame=s,this.blameRange=o,this.isFullRange=r,this.desiredCommand=l}getBlame(){return this.blame?.()}};let GitAuthorsCodeLens=class GitAuthorsCodeLens extends i.CodeLens{constructor(e,n,t,i,s,o,r,a){super(r),this.languageId=e,this.symbol=n,this.uri=t,this.blame=i,this.blameRange=s,this.isFullRange=o,this.desiredCommand=a}getBlame(){return this.blame()}};let GitCodeLensProvider=class GitCodeLensProvider{constructor(e){this.container=e}static selector=[...(0,u.Tj)(s.MV,e=>({scheme:e}))];_onDidChangeCodeLenses=new i.EventEmitter;get onDidChangeCodeLenses(){return this._onDidChangeCodeLenses.event}dispose(){this._onDidChangeCodeLenses.dispose()}reset(){this._onDidChangeCodeLenses.fire()}async provideCodeLenses(e,n){var t=[];try{let s,o;if(e.isDirty&&(0,l.QK)(e.uri))return[];let u=p(t,(0,m.bP)(`${(0,d.zu)(this)}.provideCodeLenses(${d.Vy.toLoggable(e)})`,!1)),g=await this.container.documentTracker.getOrAdd(e),h=await g.getStatus();if(!h.blameable)return[];let y=!1;e.isDirty&&!h.dirtyIdle&&(y=!0);let b=a.H.get("codeLens",e),f={...b.scopesByLanguage?.find(n=>n.language?.toLowerCase()===e.languageId)};null==f&&(f={language:e.languageId}),null==f.scopes&&(f.scopes=b.scopes),null==f.symbolScopes&&(f.symbolScopes=b.symbolScopes),f.symbolScopes=null!=f.symbolScopes?f.symbolScopes=f.symbolScopes.map(e=>e.toLowerCase()):[];let C=[],S=g.uri;if(y){if(1!==f.scopes.length||!f.scopes.includes("document")){let n;if([n,o]=await Promise.all([this.container.git.isTracked(S),(0,r.S4)("vscode.executeDocumentSymbolProvider",e.uri)]),!n)return C}}else if(n.isCancellationRequested||(1===f.scopes.length&&f.scopes.includes("document")?s=await this.container.git.getBlame(S,e):[s,o]=await Promise.all([this.container.git.getBlame(S,e),(0,r.S4)("vscode.executeDocumentSymbolProvider",e.uri)]),null==s||s?.lines.length===0))return C;if(n.isCancellationRequested)return C;let v=(0,c.Oo)(()=>e.validateRange(new i.Range(0,0,1e6,1e6))),w=y?{command:void 0,title:this.getDirtyTitle(b)}:void 0;if(void 0!==o)for(let n of(d.Vy.log(u,`${o.length} symbol(s) found`),o))this.provideCodeLens(C,e,n,f,v,s,S,b,y,w);if((f.scopes.includes("document")||f.symbolScopes.includes("file"))&&!f.symbolScopes.includes("!file")&&null==C.find(e=>0===e.range.start.line&&0===e.range.end.line)){let n,t=v();if(y||b.recentChange.enabled){y||(n=(0,c.Oo)(()=>this.container.git.getBlameRange(s,S,t)));let o=new i.SymbolInformation(S.fileName,i.SymbolKind.File,"",new i.Location(S.documentUri(),new i.Range(0,0,0,t.start.character)));C.push(new GitRecentChangeCodeLens(e.languageId,o,S,b.dateFormat,n,t,!0,U(o),b.recentChange.command,w))}if(!y&&b.authors.enabled){void 0===n&&(n=(0,c.Oo)(()=>this.container.git.getBlameRange(s,S,t)));let o=new i.SymbolInformation(S.fileName,i.SymbolKind.File,"",new i.Location(S.documentUri(),new i.Range(0,1,0,t.start.character)));C.push(new GitAuthorsCodeLens(e.languageId,o,S,n,t,!0,U(o),b.authors.command))}}return C}catch(e){var s=e,o=!0}finally{b(t,s,o)}}getValidateSymbolRange(e,n,t,s){let o,r=!1,a=i.SymbolKind[e.kind].toLowerCase();switch(e.kind){case i.SymbolKind.File:(n.scopes.includes("containers")||n.symbolScopes.includes(a))&&(r=!n.symbolScopes.includes(`!${a}`)),r&&(o=t());break;case i.SymbolKind.Package:(n.scopes.includes("containers")||n.symbolScopes.includes(a))&&(r=!n.symbolScopes.includes(`!${a}`)),r&&0===(o=U(e)).start.line&&0===o.end.line&&(o=t());break;case i.SymbolKind.Class:case i.SymbolKind.Interface:case i.SymbolKind.Module:case i.SymbolKind.Namespace:case i.SymbolKind.Struct:(n.scopes.includes("containers")||n.symbolScopes.includes(a))&&(o=U(e),r=!n.symbolScopes.includes(`!${a}`)&&(s||!o.isSingleLine));break;case i.SymbolKind.Constructor:case i.SymbolKind.Enum:case i.SymbolKind.Function:case i.SymbolKind.Method:case i.SymbolKind.Property:(n.scopes.includes("blocks")||n.symbolScopes.includes(a))&&(o=U(e),r=!n.symbolScopes.includes(`!${a}`)&&(s||!o.isSingleLine));break;case i.SymbolKind.String:(n.symbolScopes.includes(a)||"markdown"===n.language&&n.scopes.includes("containers"))&&(o=U(e),r=!n.symbolScopes.includes(`!${a}`)&&(s||!o.isSingleLine));break;default:n.symbolScopes.includes(a)&&(o=U(e),r=!n.symbolScopes.includes(`!${a}`)&&(s||!o.isSingleLine))}return r?o??U(e):void 0}provideCodeLens(e,n,t,s,o,r,a,l,u,d){try{let m,g=this.getValidateSymbolRange(t,s,o,l.includeSingleLineSymbols);if(void 0===g)return;let h=n.lineAt(U(t).start);if(e.length&&e[e.length-1].range.start.line===h.lineNumber)return;let y=0;if((u||l.recentChange.enabled)&&(u||(m=(0,c.Oo)(()=>this.container.git.getBlameRange(r,a,g))),e.push(new GitRecentChangeCodeLens(n.languageId,t,a,l.dateFormat,m,g,!1,h.range.with(new i.Position(h.range.start.line,y)),l.recentChange.command,d)),y++),l.authors.enabled){let s=!g.isSingleLine;if(!s&&"csharp"===n.languageId)switch(t.kind){case i.SymbolKind.File:break;case i.SymbolKind.Package:case i.SymbolKind.Module:case i.SymbolKind.Namespace:case i.SymbolKind.Class:case i.SymbolKind.Interface:case i.SymbolKind.Constructor:case i.SymbolKind.Method:case i.SymbolKind.Function:case i.SymbolKind.Enum:s=!0}s&&!u&&(void 0===m&&(m=(0,c.Oo)(()=>this.container.git.getBlameRange(r,a,g))),e.push(new GitAuthorsCodeLens(n.languageId,t,a,m,g,!1,h.range.with(new i.Position(h.range.start.line,y)),l.authors.command)))}}finally{if(D(t))for(let i of t.children)this.provideCodeLens(e,n,i,s,o,r,a,l,u,d)}}resolveCodeLens(e,n){return e instanceof GitRecentChangeCodeLens?this.resolveGitRecentChangeCodeLens(e,n):e instanceof GitAuthorsCodeLens?this.resolveGitAuthorsCodeLens(e,n):Promise.reject(void 0)}resolveGitRecentChangeCodeLens(e,n){let t=e.getBlame();if(null==t)return I("Unknown, (Blame failed)",e);let s=(0,u.$1)(t.commits.values());if(null==s)return I("Unknown, (Blame failed)",e);let o=`${s.author.name}, ${null==e.dateFormat?s.formattedDate:s.formatDate(e.dateFormat)}`;if(a.H.get("debug")&&(o+=` [${e.languageId}: ${i.SymbolKind[e.symbol.kind]}(${e.range.start.character}-${e.range.end.character}${e.symbol.containerName?`|${e.symbol.containerName}`:""}), Lines (${e.blameRange.start.line+1}-${e.blameRange.end.line+1}), Commit (${s.shortSha})]`),!1===e.desiredCommand)return I(o,e);switch(e.desiredCommand){case"gitlens.copyRemoteCommitUrl":return C(o,e,s,!0);case"gitlens.copyRemoteFileUrl":return S(o,e,s,!0);case"gitlens.diffWithPrevious":return f(o,e,s);case"gitlens.openCommitOnRemote":return C(o,e,s);case"gitlens.openFileOnRemote":return S(o,e,s);case"gitlens.revealCommitInView":return v(o,e,s);case"gitlens.showCommitsInView":return w(o,e,t,s);case"gitlens.showQuickCommitDetails":return L(o,e,s);case"gitlens.showQuickCommitFileDetails":return F(o,e,s);case"gitlens.showQuickRepoHistory":return R(o,e);case"gitlens.showQuickFileHistory":return $(o,e);case"gitlens.toggleFileBlame":return k(o,e);case"gitlens.toggleFileChanges":return K(o,e,s);case"gitlens.toggleFileChangesOnly":return K(o,e,s,!0);case"gitlens.toggleFileHeatmap":return P(o,e);default:return e}}resolveGitAuthorsCodeLens(e,n){let t=e.getBlame();if(null==t)return I("? authors (Blame failed)",e);let s=t.authors.size,o=(0,u.$1)(t.authors.values())?.name??"Unknown",r=s>1?` and ${(0,g.td)("one other",s-1,{only:!0,plural:"others"})}`:"",l=`${(0,g.td)("author",s,{zero:"?"})} (${o}${r})`;if(a.H.get("debug")&&(l+=` [${e.languageId}: ${i.SymbolKind[e.symbol.kind]}(${e.range.start.character}-${e.range.end.character}${e.symbol.containerName?`|${e.symbol.containerName}`:""}), Lines (${e.blameRange.start.line+1}-${e.blameRange.end.line+1}), Authors (${(0,u.fj)((0,u.Tj)(t.authors.values(),e=>e.name),", ")})]`),!1===e.desiredCommand)return I(l,e);let c=(0,u.I6)(t.commits.values(),e=>e.author.name===o)??(0,u.$1)(t.commits.values());if(null==c)return I(l,e);switch(e.desiredCommand){case"gitlens.copyRemoteCommitUrl":return C(l,e,c,!0);case"gitlens.copyRemoteFileUrl":return S(l,e,c,!0);case"gitlens.diffWithPrevious":return f(l,e,c);case"gitlens.openCommitOnRemote":return C(l,e,c);case"gitlens.openFileOnRemote":return S(l,e,c);case"gitlens.revealCommitInView":return v(l,e,c);case"gitlens.showCommitsInView":return w(l,e,t);case"gitlens.showQuickCommitDetails":return L(l,e,c);case"gitlens.showQuickCommitFileDetails":return F(l,e,c);case"gitlens.showQuickRepoHistory":return R(l,e);case"gitlens.showQuickFileHistory":return $(l,e);case"gitlens.toggleFileBlame":return k(l,e);case"gitlens.toggleFileChanges":return K(l,e,c);case"gitlens.toggleFileChangesOnly":return K(l,e,c,!0);case"gitlens.toggleFileHeatmap":return P(l,e);default:return e}}getDirtyTitle(e){return e.recentChange.enabled&&e.authors.enabled?a.H.get("strings.codeLens.unsavedChanges.recentChangeAndAuthors"):e.recentChange.enabled?a.H.get("strings.codeLens.unsavedChanges.recentChangeOnly"):a.H.get("strings.codeLens.unsavedChanges.authorsOnly")}};function f(e,n,t){return n.command=(0,r.gu)("gitlens.diffWithPrevious",e,void 0,{commit:t,uri:n.uri.toFileUri()}),n}function C(e,n,t,i=!1){return n.command=(0,r.gu)("gitlens.openOnRemote",e,{resource:{type:o.J.Commit,sha:t.sha},repoPath:t.repoPath,clipboard:i}),n}function S(e,n,t,i=!1){return n.command=(0,r.gu)("gitlens.openOnRemote",e,{resource:{type:o.J.Revision,fileName:t.file?.path??"",sha:t.sha},repoPath:t.repoPath,clipboard:i}),n}function v(e,n,t){return n.command=(0,r.gu)(t?.isUncommitted?"":"gitlens.revealCommitInView",e,n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}),n}function w(e,n,t,i){let s;return s=void 0===i?[...(0,u.x1)(t.commits.values(),e=>e.isUncommitted?void 0:e.ref)]:[i.ref],n.command=(0,r.gu)(0===s.length?"":"gitlens.showCommitsInView",e,{repoPath:t.repoPath,refs:s}),n}function L(e,n,t){return n.command=(0,r.gu)(t?.isUncommitted?"":"gitlens.showQuickCommitDetails",e,n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}),n}function F(e,n,t){return n.command=(0,r.gu)(t?.isUncommitted?"":"gitlens.showQuickCommitFileDetails",e,n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}),n}function R(e,n){return n.command=(0,r.gu)("gitlens.showQuickRepoHistory",e,n.uri.toFileUri()),n}function $(e,n){return n.command=(0,r.gu)("gitlens.showQuickFileHistory",e,n.uri.toFileUri(),{range:n.isFullRange?void 0:n.blameRange}),n}function k(e,n){return n.command=(0,r.gu)("gitlens.toggleFileBlame",e,n.uri.toFileUri()),n}function K(e,n,t,i){return n.command=(0,r.gu)("gitlens.toggleFileChanges",e,n.uri.toFileUri(),{type:"changes",context:{sha:t.sha,only:i,selection:!1}}),n}function P(e,n){return n.command=(0,r.gu)("gitlens.toggleFileHeatmap",e,n.uri.toFileUri()),n}function I(e,n){return n.command={title:e,command:""},n}function U(e){return D(e)?e.range:e.location.range}function D(e){return(0,c.is)(e,"children")}}};